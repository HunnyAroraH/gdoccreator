<form id="docForm">
    <label for="iboName">IBO Name:</label>
    <input type="text" id="iboName" name="iboName" required><br><br>

    <label for="iboNumber">IBO Number:</label>
    <input type="text" id="iboNumber" name="iboNumber" required><br><br>

    <button type="submit">Generate Links and Create Google Doc</button>
</form>

<div id="progress-bar" style="display:none;">
    <p>Generating Links... Please wait</p>
    <progress value="0" max="100" id="progress"></progress>
</div>

<div id="docLink" style="display:none;">
    <p>Document created! Here is the link: <a href="" id="docUrl" target="_blank">Open Google Doc</a></p>
</div>

<script>
    const form = document.getElementById('docForm');
    const progressBar = document.getElementById('progress-bar');
    const progress = document.getElementById('progress');
    const docLink = document.getElementById('docLink');
    const docUrl = document.getElementById('docUrl');

    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const formData = new FormData(form);

        progressBar.style.display = 'block';
        docLink.style.display = 'none';
        progress.value = 20;

        try {
            // First, call the scraper endpoint
            const scrapeResponse = await fetch('/scrape-service-links', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    iboName: formData.get('iboName'),
                    iboNumber: formData.get('iboNumber')
                })
            });

            const scrapeData = await scrapeResponse.json();

            if (scrapeResponse.ok) {
                progress.value = 60;
                // Now that the links are scraped, proceed to generate the Google Doc
                const docResponse = await fetch('/create-doc', {
                    method: 'POST',
                    body: formData
                });

                const docData = await docResponse.json();

                if (docData.success) {
                    progress.value = 100;
                    docLink.style.display = 'block';
                    docUrl.href = docData.docLink;
                } else {
                    alert('Error creating document: ' + docData.message);
                }
            } else {
                alert('Error scraping links: ' + scrapeData.error);
            }
        } catch (error) {
            alert('Error: ' + error.message);
        } finally {
            progressBar.style.display = 'none';
        }
    });
</script>
