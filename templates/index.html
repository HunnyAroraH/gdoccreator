<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Google Document</title>
</head>
<body>
    <h1>Generate Google Document</h1>

    <form id="docForm">
        <label for="iboName">IBO Name:</label>
        <input type="text" id="iboName" name="iboName" required><br><br>

        <label for="iboNumber">IBO Number:</label>
        <input type="text" id="iboNumber" name="iboNumber" required><br><br>

        <button type="submit">Create Google Doc</button>
    </form>

    <div id="progress-bar" style="display:none;">
        <p>Generating Google Doc... Please wait</p>
        <progress value="0" max="100" id="progress"></progress>
    </div>

    <div id="docLink" style="display:none;">
        <p>Document created! Here is the link: <a href="" id="docUrl" target="_blank">Open Google Doc</a></p>
    </div>

    <script>
        const form = document.getElementById('docForm');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const docLink = document.getElementById('docLink');
        const docUrl = document.getElementById('docUrl');
    
        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(form);
    
            progressBar.style.display = 'block';
            docLink.style.display = 'none';
            progress.value = 20;
    
            // Step 1: Trigger the scraping process
            const scrapeResponse = await fetch('/scrape-service-links', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    iboName: formData.get('iboName'),
                    iboNumber: formData.get('iboNumber')
                })
            });
    
            const scrapeData = await scrapeResponse.json();
    
            if (scrapeResponse.ok) {
                progress.value = 50;
    
                // Step 2: Once scraping is successful, trigger Google Doc creation
                const docResponse = await fetch('/create-doc', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        iboName: formData.get('iboName'),
                        iboNumber: formData.get('iboNumber')
                    })
                });
    
                const docData = await docResponse.json();
    
                if (docResponse.ok) {
                    progress.value = 100;
                    docLink.style.display = 'block';
                    docUrl.href = docData.docLink;
                } else {
                    alert('Error creating Google Doc: ' + docData.message);
                }
    
            } else {
                alert('Error during scraping: ' + scrapeData.message);
            }
    
            progressBar.style.display = 'none';
        });
    </script>
</body>
</html>
